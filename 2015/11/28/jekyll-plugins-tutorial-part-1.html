<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>1. Introduction to plugins with Jekyll 3.0: pictures of squirrels</title>
  <meta name="description" content="While writing the framework behind Magnetite, I ended up writing a number of plugins to do various things.  While there is documentation on bothJekyll plugin...">

  <link rel="stylesheet" href="/jekyll-plugins-tutorial/css/main.css">
  <link rel="canonical" href="osfameron.github.io/jekyll-plugins-tutorial/2015/11/28/jekyll-plugins-tutorial-part-1.html">
  <link rel="alternate" type="application/rss+xml" title="A Jekyll plugin tutorial" href="osfameron.github.io/jekyll-plugins-tutorial/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/jekyll-plugins-tutorial/">A Jekyll plugin tutorial</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/jekyll-plugins-tutorial/about/">About</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">1. Introduction to plugins with Jekyll 3.0: pictures of squirrels</h1>
    <p class="post-meta"><time datetime="2015-11-28T15:20:00+00:00" itemprop="datePublished">Nov 28, 2015</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>While writing the framework behind <a href="http://magnetite-book.com/">Magnetite</a>, I ended up writing a number of plugins to do various things.  While there is documentation on both
<a href="http://jekyllrb.com/docs/plugins/">Jekyll plugins</a> and <a href="https://github.com/Shopify/liquid/wiki/Liquid-for-Programmers">Liquid templating</a>, I found it a little terse on some details (like the precise parameters used), on the bigger picture (which kind of plugin should you use when), and on how to ensure quality in the software engineering of the plugin (testing etc.).  This short series of blog posts will go through a few motivating examples, examining the different ways to accomplish the task at hand.</p>

<p>I’m assuming you’re a programmer and either know Ruby or a similar language (Perl, Python, Javascript etc.) and basic HTML and CSS.  You’ve installed Jekyll, know how to build and serve a simple site.  And hopefully you’ve skimmed the 2 links above and they made some sense.  (If you’re unsure about any of these, it may be worth starting with the <a href="http://jekyllrb.com/docs/home/">Jekyll docs</a> first!)</p>

<p>I’ll be using Jekyll 3.0, and recommend you upgrade if you’re still on Jekyll 2.0.  I’m not an expert in Jekyll (or Ruby in fact) so comments welcome on better approaches, code improvements, and ways to make and 3.0 specific examples work in earlier versions!</p>

<h2 id="example-inserting-images">Example: inserting images</h2>

<p>Markdown allows you to insert images with a simple (if not especially mnemonic) piece of markup.</p>

<figure class="highlight"><pre><code class="language-markdown" data-lang="markdown">    !<span class="p">[</span><span class="nv">A lovely squirrel</span><span class="p">](</span><span class="sx">/images/squirrel.jpg</span><span class="p">)</span></code></pre></figure>

<p>(Actually, if you’re running somewhere like Github pages – as this blog is currently – you’ll need to prepend the <code>baseurl</code> (in this case <code>/jekyll-plugins-tutorial</code>).  So the actual code is something like:</p>

<figure class="highlight"><pre><code class="language-markdown" data-lang="markdown">    !<span class="p">[</span><span class="nv">A lovely squirrel</span><span class="p">](</span><span class="sx">{{</span> site.baseurl }}/images/squirrel.jpg)</code></pre></figure>

<p>This produces the following HTML:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">    <span class="nt">&lt;img</span> <span class="na">alt=</span><span class="s">"A lovely squirrel"</span> <span class="na">src=</span><span class="s">"/jekyll-plugins-tutorial/images/squirrel.jpg"</span><span class="nt">&gt;</span></code></pre></figure>

<p>And the following image:</p>

<p><img src="/jekyll-plugins-tutorial/images/squirrel.jpg" alt="A lovely squirrel" /></p>

<p>But that’s not necessarily all you want to do with an image.  You may wish to wrap it in a <code>&lt;div&gt;</code> to format the CSS container (or perhaps better, a more semantic <code>&lt;figure&gt;</code>) and as well the <code>alt</code> tag, you might want a caption.  (Certainly the photographer who has released the image under a Creative Commons license will want you to credit them!)  For bonus points, the caption should link to the source of the image.  Putting that all together we might do something like:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">    <span class="nt">&lt;figure&gt;</span>
      <span class="nt">&lt;img</span> <span class="na">alt=</span><span class="s">"A lovely squirrel"</span> <span class="na">src=</span><span class="s">"/jekyll-plugins-tutorial/images/squirrel.jpg"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;figcaption&gt;</span>
        A lovely squirrel.
        Image credit:
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"https://www.flickr.com/photos/47644980@N00/5681166704"</span><span class="nt">&gt;</span>
           CC-BY-NC-SA hakim.cassimally
        <span class="nt">&lt;/a&gt;</span>
      <span class="nt">&lt;/figcaption&gt;</span>
    <span class="nt">&lt;/figure&gt;</span></code></pre></figure>

<p>Which gives us:</p>

<figure>
  <img alt="A lovely squirrel" src="/jekyll-plugins-tutorial/images/squirrel.jpg" />
  <figcaption>
    A lovely squirrel.
    Image credit:
    <a href="https://www.flickr.com/photos/47644980@N00/5681166704">
       CC-BY-NC-SA hakim.cassimally
    </a>
  </figcaption>
</figure>

<p>Of course in Markdown you can insert this HTML verbatim.  But it’s a fair amount of boilerplate (we’ve even written the same <code>alt</code> text in two places).  So if we ever use the image again (and we may well do, as it is such a lovely squirrel) then we’re going to have to type (or copy-paste) it.  Worse, if we change the markup or the details, we’ll have to remember to edit all the places we used it!</p>

<p>Let’s look at those 2 issues (markup and details) in turn.</p>

<h3 id="abstracting-markup">Abstracting markup</h3>

<p>This is where I’m going to start telling you about plugins, right?  Well, not quite.  While we could (and it’s what I did when I first approached this problem) it’s perhaps more useful to see what <em>built-in</em> Jekyll functionality we can apply to deal with the problem.</p>

<p>The obvious solution is a <a href="http://jekyllrb.com/docs/templates/#includes">template include</a>. So we could write:</p>

<figure class="highlight"><pre><code class="language-markdown" data-lang="markdown">    {% include image src="/images/squirrel.jpg"
         alt="A lovely squirrel (via include)"
         credit="CC-BY-NC-SA hakim.cassimally"
         creditlink="https://www.flickr.com/photos/47644980@N00/5681166704" %}</code></pre></figure>

<p>These variables get passed in in the <code>include</code> object.  Note that here, I’m passing <code>src</code> without the <code>baseurl</code>: this cleans up the code at the point of calling - but we’ll have to add it inside the included template. So now, all we need is the new include called <code>_includes/image</code> like so:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">    <span class="nt">&lt;figure&gt;</span>
     <span class="nt">&lt;img</span> <span class="na">alt=</span><span class="s">"{{ include.alt }}"</span> <span class="na">src=</span><span class="s">"{{ include.src | prepend: site.baseurl }}"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;figcaption&gt;</span>
       {{ include.alt }}
       Image credit:
       <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{{ include.creditlink }}"</span><span class="nt">&gt;</span>
         {{ include.credit }}
       <span class="nt">&lt;/a&gt;</span>
     <span class="nt">&lt;/figcaption&gt;</span>
   <span class="nt">&lt;/figure&gt;</span></code></pre></figure>

<blockquote>
  <p><strong>NB:</strong> I called the file <code>_includes/image</code> rather than <code>_includes/image.html</code> despite the fact that all the default Jekyll templates in <code>_includes</code> have the <code>.html</code> suffix.  That’s because <code>{% include image %}</code> feels more “pluginny”, and distinguishes these widget style includes from layout ones like <code>head.html</code> etc.</p>
</blockquote>

<p>Let’s try it out!</p>

<figure>
  <img alt="A lovely squirrel (via include)" src="/jekyll-plugins-tutorial/images/squirrel.jpg" />
  <figcaption>
    A lovely squirrel (via include)
    Image credit:
    <a href="https://www.flickr.com/photos/47644980@N00/5681166704">
      CC-BY-NC-SA hakim.cassimally
    </a>
  </figcaption>
</figure>

<p>Hurray for squirrels!</p>

<h3 id="abstracting-the-data">Abstracting the data</h3>

<p>Though this is getting a little nicer, I think what we really want is this:</p>

<figure class="highlight"><pre><code class="language-markdown" data-lang="markdown">    {% include image id="squirrel" %}</code></pre></figure>

<p>We can use Jekyll’s lovely <a href="http://jekyllrb.com/docs/datafiles/">Data Files</a> to store the
information.  For example if we create a file called <code>_data/images.yml</code> and
transfer our information into tha}</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml">   <span class="s">squirrel</span><span class="pi">:</span>
     <span class="s">src</span><span class="pi">:</span> <span class="s">/images/squirrel.jpg</span>
     <span class="s">alt</span><span class="pi">:</span> <span class="s2">"</span><span class="s">A</span><span class="nv"> </span><span class="s">lovely</span><span class="nv"> </span><span class="s">squirrel</span><span class="nv"> </span><span class="s">(via</span><span class="nv"> </span><span class="s">include</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">data)"</span>
     <span class="s">credit</span><span class="pi">:</span> <span class="s">CC-BY-NC-SA hakim.cassimally</span>
     <span class="s">creditlink</span><span class="pi">:</span> <span class="s">https://www.flickr.com/photos/47644980@N00/5681166704</span></code></pre></figure>

<p>Now let’s update our <code>_includes/image</code>.</p>

<figure class="highlight"><pre><code class="language-markdown" data-lang="markdown">    {% assign image = site.data.images<span class="p">[</span><span class="nv">include.id</span><span class="p">]</span> | default: include %}
    <span class="nt">&lt;figure&gt;</span>
      <span class="nt">&lt;img</span> <span class="na">alt=</span><span class="s">"{{ image.alt }}"</span> <span class="na">src=</span><span class="s">"{{ image.src | prepend: site.baseurl }}"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;figcaption&gt;</span>
        {{ image.alt }}
        Image credit:
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"{{ image.creditlink }}"</span><span class="nt">&gt;</span>
          {{ image.credit }}
        <span class="nt">&lt;/a&gt;</span>
      <span class="nt">&lt;/figcaption&gt;</span>
    <span class="nt">&lt;/figure&gt;</span></code></pre></figure>

<p>The first line gets the <code>id</code> from the call, and fetches the data from the yaml file by checking in <code>site.data.images</code> (which gets resolved to <code>_data/images.yml</code>)  If it finds it, then we carry on as before, except that we’re looking in this new <code>images</code> instead of the <code>include</code> object.  If we don’t find it, then we default to the previous behaviour.  Let’s see if it works:</p>

<figure>
  <img alt="A lovely squirrel (via include + data)" src="/jekyll-plugins-tutorial/images/squirrel.jpg" />
  <figcaption>
    A lovely squirrel (via include + data)
    Image credit:
    <a href="https://www.flickr.com/photos/47644980@N00/5681166704">
      CC-BY-NC-SA hakim.cassimally
    </a>
  </figcaption>
</figure>

<p>So, if you’ve read up to this point, you’ll realise I’ve led you a merry dance and we’ve not even seen a hint of an actual plugin!  But don’t worry, we’ll (probably) look at them in the next post.</p>


  </div>
  <h2> Comments </h2>
  (Please comment below, or grab me on IRC: osfameron on #jekyll)
  
<section id="disqus_thread"></section>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'jekyllpluginstutorial'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">A Jekyll plugin tutorial</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>A Jekyll plugin tutorial</li>
          <li><a href="mailto:osfameron@cpan.org">osfameron@cpan.org</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/osfameron"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">osfameron</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/osfameron"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">osfameron</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>A brief series of blog posts about how to create and test plugins for the Jekyll static blog framework.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
